cmake_minimum_required(VERSION 3.6)

project(dwarf)

add_library(dwarf dwarf.cc cursor.cc die.cc value.cc abbrev.cc
  expr.cc rangelist.cc line.cc attrs.cc
  die_str_map.cc elf.cc to_string.cc)

add_custom_command(
  OUTPUT to_string.cc
  DEPENDS ../elf/enum-print.py dwarf++.hh data.hh Makefile
  COMMAND echo "// Automatically generated by make at $$(date)" > to_string.cc
  COMMAND echo "// DO NOT EDIT" >> to_string.cc
  COMMAND echo >> to_string.cc
  COMMAND echo "#include \"internal.hh\"" >> to_string.cc
  COMMAND echo >> to_string.cc
  COMMAND echo 'DWARFPP_BEGIN_NAMESPACE' >> to_string.cc
  COMMAND echo >> to_string.cc
  python3 ../elf/enum-print.py < dwarf++.hh >> to_string.cc
  python3 ../elf/enum-print.py -s _ -u --hex -x hi_user -x lo_user < data.hh >> to_string.cc
  COMMAND echo 'DWARFPP_END_NAMESPACE' >> to_string.cc
)
add_custom_target(to_string_code DEPENDS to_string.cc)
